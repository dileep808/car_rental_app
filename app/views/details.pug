//- details.pug
doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= title || "Car Details | Velocity Rentals"
    link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css")
    link(rel="stylesheet", href="/home.css")
    link(rel="stylesheet", href="/dashboard.css")
  include sidebar.pug
  body
    - const money = (v) => `£${Number(v || 0).toLocaleString('en-GB', { maximumFractionDigits: 0 })}`;
    - const fmtDate = (v) => {
    -   if (!v) return '—';
    -   const d = new Date(v);
    -   return isNaN(d.getTime()) ? v : d.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
    - };

    .sidebar-shell
      +sidebar('dashboard')
      main.sidebar-content.dashboard
        if error
          .error-banner #{error}

        if car
          section.hero#overview
            .container
              .hero-content.dashboard-hero
                .eyebrow Vehicle
                h1 #{car.make} #{car.model} (#{car.year})
                p Snapshot of availability, rate, and booking history.
                .quick-actions
                  a.btn.btn-outline(href="/dashboard#fleet") Back to fleet
                  a.btn.btn-primary(href="/dashboard") Dashboard
          section#stats
            .container
              .section-title
                h2 Vehicle overview
              .detail-grid
                .detail-card
                  .label Status
                  span(class=`badge ${car.status === 'available' ? 'badge-available' : car.status === 'maintenance' ? 'badge-maintenance' : 'badge-booked'}`)= car.status || '—'
                .detail-card
                  .label Daily rate
                  h3= money(car.daily_rate)
                .detail-card
                  .label Location
                  h3= car.location || '—'
                .detail-card
                  .label Added
                  h3= fmtDate(car.created_at)

          section#bookings
            .container
              .section-title
                h2 Booking history
                p Last 20 bookings for this vehicle.
              .card
                table.data-table
                  thead
                    tr
                      th Booking
                      th Customer
                      th Status
                      th Start
                      th End
                      th Total
                  tbody
                    if bookings && bookings.length
                      each b in bookings
                        - const badgeClass = (() => { const s = (b.status || '').toLowerCase(); if (s === 'available') return 'badge-available'; if (s === 'ongoing') return 'badge-ongoing'; if (s === 'maintenance') return 'badge-maintenance'; return 'badge-booked'; })();
                        tr
                          td #{'#' + b.id}
                          td #{b.customer}
                          td
                            span(class=`badge ${badgeClass}`)= b.status || '—'
                          td #{fmtDate(b.start_date)}
                          td #{fmtDate(b.end_date)}
                          td= money(b.total_price)
                    else
                      tr
                        td(colspan="6") No bookings for this vehicle yet.
        else
          section
            .container
              .card
                .section-title
                  h2 No vehicle found
                  p The requested vehicle could not be loaded.

    footer
      .container.footer-meta
        span Velocity Rentals
        span •
        span Vehicle details
